<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI æ¢ç´¢è€… - æ–°æ‰‹å¼•å¯¼ç³»ç»Ÿ</title>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --gold-accent: #FFD700;
      --cream: #FFF8E7;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Fredoka', 'Comic Neue', sans-serif;
      background: #F5F5F5;
      min-height: 100vh;
      padding: 20px;
    }
    .v8-container {
      display: flex; flex-direction: column; align-items: center;
      gap: 20px; max-width: 840px; margin: 0 auto;
    }
    .page-title { font-size: 20px; font-weight: 700; color: #333; text-align: center; }
    .page-subtitle { font-size: 13px; color: #888; text-align: center; margin-top: -12px; }

    /* ===== å±å¹• ===== */
    .screen-area {
      width: 800px; height: 480px; border-radius: 12px; overflow: hidden;
      box-shadow: 0 4px 20px rgba(0,0,0,0.15); position: relative; background: #000;
    }

    /* ===== åœºæ™¯é€šç”¨ ===== */
    .scene {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      opacity: 0; pointer-events: none; transition: opacity 0.6s ease;
      background-size: cover; background-position: center; background-repeat: no-repeat;
    }
    .scene.active { opacity: 1; pointer-events: auto; }

    /* ===== å¹•æ¬¡æ ‡ç­¾ ===== */
    .act-label {
      position: absolute; top: 12px; left: 12px;
      background: rgba(0,0,0,0.5); backdrop-filter: blur(6px);
      color: white; padding: 4px 12px; border-radius: 8px;
      font-size: 11px; font-weight: 600; z-index: 100;
      display: flex; align-items: center; gap: 6px;
    }
    .act-dot { width: 6px; height: 6px; background: #4ADE80; border-radius: 50%; }
    .act-time { color: rgba(255,255,255,0.6); margin-left: 4px; }

    /* ===== è¿›åº¦æ¡ ===== */
    .progress-bar {
      position: absolute; bottom: 0; left: 0; right: 0;
      height: 4px; background: rgba(255,255,255,0.2); z-index: 200;
    }
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #FFD700 0%, #F59E0B 100%);
      border-radius: 0 2px 2px 0; transition: width 0.3s ease;
    }

    /* ===== æ—ç™½æ–‡å­— ===== */
    .narration {
      position: absolute; bottom: 28px; left: 50%; transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(12px);
      padding: 14px 28px; border-radius: 16px; color: #FFF8E7;
      font-size: 15px; font-weight: 500; text-align: center;
      max-width: 580px; line-height: 1.7; z-index: 50;
      opacity: 0; transition: opacity 0.5s;
    }
    .narration.show { opacity: 1; }
    .narration .highlight { color: #FFD700; font-weight: 700; }

    /* ===== åœºæ™¯1ï¼šç¥å¥‡çš„å‘ç° ===== */
    .scene-discovery { background-image: url('bg/scene1.png'); }
    .soundwave-ring {
      position: absolute; border-radius: 50%;
      border: 2px solid rgba(255, 215, 0, 0.5);
      animation: ringExpand 2.5s ease-out infinite;
    }
    .soundwave-ring:nth-child(2) { animation-delay: 0.6s; }
    .soundwave-ring:nth-child(3) { animation-delay: 1.2s; }
    @keyframes ringExpand {
      0% { width: 20px; height: 20px; opacity: 0.7; margin-left: -10px; margin-top: -10px; }
      100% { width: 120px; height: 120px; opacity: 0; margin-left: -60px; margin-top: -60px; }
    }
    .flower-waves { position: absolute; top: 50%; right: 30%; }

    /* ===== åœºæ™¯2ï¼šä¼Ÿå¤§çš„æ—…ç¨‹ ===== */
    .scene-journey { overflow: hidden; }
    .journey-panels {
      display: flex; width: 300%; height: 100%; transition: transform 1s ease-in-out;
    }
    .journey-panel {
      width: 800px; height: 480px; position: relative; flex-shrink: 0;
      background-size: cover; background-position: center;
    }
    .panel-rainforest { background-image: url('bg/scene2a.png'); }
    .panel-glacier { background-image: url('bg/scene2b.png'); }
    .panel-ocean { background-image: url('bg/scene2c.png'); }

    /* ===== åœºæ™¯3ï¼šçˆ·çˆ·çš„é—æ†¾ ===== */
    .scene-regret { background-image: url('bg/scene3.png'); }
    .floating-sparkle {
      position: absolute; font-size: 14px; opacity: 0;
      animation: sparkleDrift 4s ease-in-out infinite;
    }
    .floating-sparkle:nth-child(1) { top: 20%; left: 15%; animation-delay: 0s; }
    .floating-sparkle:nth-child(2) { top: 35%; left: 75%; animation-delay: 1.2s; }
    .floating-sparkle:nth-child(3) { top: 15%; left: 50%; animation-delay: 2.4s; }
    @keyframes sparkleDrift {
      0%, 100% { opacity: 0; transform: translateY(0) scale(0.5); }
      50% { opacity: 0.8; transform: translateY(-10px) scale(1); }
    }

    /* ===== åœºæ™¯4ï¼šäº¤ç»™ä½  ===== */
    .scene-handover { background-image: url('bg/scene4.png'); }
    .letter-card {
      position: absolute; bottom: 50px; left: 50%;
      transform: translateX(-50%) scale(0.85);
      width: 460px; background: rgba(255, 254, 245, 0.93);
      backdrop-filter: blur(8px); border-radius: 16px;
      padding: 24px 32px;
      box-shadow: 0 8px 32px rgba(139, 90, 43, 0.25);
      border: 2px solid rgba(232, 213, 176, 0.8);
      opacity: 0; transition: all 0.8s cubic-bezier(0.34, 1.56, 0.64, 1); z-index: 20;
    }
    .letter-card.show { transform: translateX(-50%) scale(1); opacity: 1; }
    .letter-stamp {
      position: absolute; top: -14px; right: 24px;
      background: linear-gradient(135deg, #DC2626 0%, #B91C1C 100%);
      color: white; padding: 5px 12px; border-radius: 8px;
      font-size: 11px; font-weight: 700; transform: rotate(3deg);
      box-shadow: 0 2px 8px rgba(220,38,38,0.3);
    }
    .letter-header { font-size: 14px; color: #A67C52; font-weight: 600; margin-bottom: 10px; }
    .letter-body { font-size: 14px; color: #5D4E3A; line-height: 1.9; }
    .letter-signature {
      text-align: right; margin-top: 14px;
      font-size: 13px; color: #A67C52; font-weight: 600; font-style: italic;
    }
    .sparkle-anim {
      position: absolute; font-size: 16px; opacity: 0;
      animation: sparkleFloat 3s ease-in-out infinite;
    }
    .sparkle-anim:nth-child(1) { top: 12%; left: 18%; animation-delay: 0s; }
    .sparkle-anim:nth-child(2) { top: 22%; right: 15%; animation-delay: 0.8s; }
    .sparkle-anim:nth-child(3) { top: 8%; left: 42%; animation-delay: 1.6s; }
    @keyframes sparkleFloat {
      0%, 100% { opacity: 0; transform: translateY(0) scale(0.5); }
      50% { opacity: 1; transform: translateY(-12px) scale(1.2); }
    }

    /* ===== åœºæ™¯5ï¼šå’•å’•ç™»åœº ===== */
    .scene-gugu { background-image: url('bg/scene5.png'); }
    .gugu-eyes {
      position: absolute; top: 32%; left: 50%;
      transform: translate(-50%, -50%); display: flex; gap: 30px;
    }
    .gugu-eye {
      width: 14px; height: 14px; background: #FFD700; border-radius: 50%;
      box-shadow: 0 0 16px #FFD700; animation: eyeBlink 3s ease-in-out infinite;
    }
    .gugu-eye:nth-child(2) { animation-delay: 0.1s; }
    @keyframes eyeBlink {
      0%, 45%, 55%, 100% { transform: scaleY(1); }
      50% { transform: scaleY(0.1); }
    }
    .gugu-character {
      position: absolute; top: 32%; left: 50%; transform: translate(-50%, -50%); text-align: center;
    }
    .gugu-avatar-big {
      width: 110px; height: 110px;
      background: linear-gradient(135deg, rgba(255,215,0,0.9) 0%, rgba(255,165,0,0.9) 100%);
      border-radius: 50%; display: flex; align-items: center; justify-content: center;
      font-size: 62px; margin: 0 auto 10px;
      box-shadow: 0 0 0 5px rgba(255,215,0,0.3), 0 12px 40px rgba(255,165,0,0.4);
      opacity: 0; transform: translateY(-60px);
      transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    .gugu-avatar-big.landed { opacity: 1; transform: translateY(0); }
    .gugu-avatar-big.bounce { animation: guguBounce 0.6s ease; }
    @keyframes guguBounce {
      0% { transform: translateY(0); } 30% { transform: translateY(-16px); }
      50% { transform: translateY(0); } 70% { transform: translateY(-8px); }
      100% { transform: translateY(0); }
    }
    .gugu-name-tag {
      font-size: 20px; font-weight: 700; color: #FFD700;
      text-shadow: 0 2px 8px rgba(0,0,0,0.5); opacity: 0; transition: opacity 0.4s;
    }
    .gugu-name-tag.show { opacity: 1; }
    .feather {
      position: absolute; font-size: 18px; opacity: 0;
      animation: featherFall 2.5s ease-in-out forwards;
    }
    @keyframes featherFall {
      0% { opacity: 0; transform: translateY(-30px) rotate(0deg); }
      20% { opacity: 0.7; }
      100% { opacity: 0; transform: translateY(100px) rotate(200deg) translateX(40px); }
    }

    /* ===== åœºæ™¯6ï¼šå¿«é—¨é”®æ•™å­¦ ===== */
    .scene-shutter { background-image: url('bg/scene6.png'); }
    .viewfinder-frame {
      position: absolute; top: 48%; left: 50%; transform: translate(-50%, -50%);
      width: 160px; height: 160px;
      border: 2px solid rgba(255,255,255,0.4); border-radius: 12px; z-index: 10;
    }
    .vf-corner {
      position: absolute; width: 20px; height: 20px;
      border-color: white; border-style: solid; border-width: 0;
    }
    .vf-corner.tl { top: -2px; left: -2px; border-top-width: 3px; border-left-width: 3px; border-radius: 6px 0 0 0; }
    .vf-corner.tr { top: -2px; right: -2px; border-top-width: 3px; border-right-width: 3px; border-radius: 0 6px 0 0; }
    .vf-corner.bl { bottom: -2px; left: -2px; border-bottom-width: 3px; border-left-width: 3px; border-radius: 0 0 0 6px; }
    .vf-corner.br { bottom: -2px; right: -2px; border-bottom-width: 3px; border-right-width: 3px; border-radius: 0 0 6px 0; }
    .shutter-hint {
      position: absolute; bottom: 50px; right: 70px;
      display: flex; align-items: center; gap: 12px; z-index: 20;
    }
    .shutter-btn-demo {
      width: 58px; height: 58px;
      background: linear-gradient(180deg, #EF4444 0%, #DC2626 100%);
      border-radius: 50%; border: 4px solid rgba(255,255,255,0.8);
      display: flex; align-items: center; justify-content: center;
      font-size: 22px; color: white; cursor: pointer;
      box-shadow: 0 4px 16px rgba(239,68,68,0.5);
      animation: shutterPulse 1.5s ease-in-out infinite; transition: transform 0.15s;
    }
    .shutter-btn-demo:active { transform: scale(0.9); animation: none; }
    @keyframes shutterPulse {
      0%, 100% { box-shadow: 0 4px 16px rgba(239,68,68,0.5); }
      50% { box-shadow: 0 4px 16px rgba(239,68,68,0.5), 0 0 0 8px rgba(239,68,68,0.2); }
    }
    .finger-hint { font-size: 26px; animation: fingerTap 1.5s ease-in-out infinite; }
    @keyframes fingerTap { 0%, 100% { transform: translateX(0); } 50% { transform: translateX(-10px); } }
    .flash-overlay {
      position: absolute; top: 0; left: 0; right: 0; bottom: 0;
      background: white; z-index: 100; opacity: 0; pointer-events: none;
    }
    .flash-overlay.flash { animation: flashAnim 0.4s ease-out; }
    @keyframes flashAnim { 0% { opacity: 0.9; } 100% { opacity: 0; } }
    .star-burst { position: absolute; top: 42%; left: 50%; z-index: 110; pointer-events: none; }
    .flying-star { position: absolute; font-size: 28px; opacity: 0; }
    .flying-star.fly { animation: starFlyOut 1.2s ease-out forwards; }
    .flying-star:nth-child(1).fly { animation-delay: 0s; --tx: -60px; --ty: -80px; }
    .flying-star:nth-child(2).fly { animation-delay: 0.15s; --tx: 20px; --ty: -100px; }
    .flying-star:nth-child(3).fly { animation-delay: 0.3s; --tx: 70px; --ty: -60px; }
    @keyframes starFlyOut {
      0% { opacity: 0; transform: translate(0, 0) scale(0.3); }
      30% { opacity: 1; transform: translate(var(--tx), var(--ty)) scale(1.2); }
      60% { opacity: 1; transform: translate(var(--tx), calc(var(--ty) - 30px)) scale(1); }
      100% { opacity: 0; transform: translate(calc(var(--tx) + 100px), -200px) scale(0.5); }
    }
    .gugu-mini {
      position: absolute; bottom: 44px; left: 20px;
      display: flex; align-items: center; gap: 8px; z-index: 50;
    }
    .gugu-mini-avatar {
      width: 42px; height: 42px;
      background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
      border-radius: 50%; display: flex; align-items: center; justify-content: center;
      font-size: 24px; box-shadow: 0 3px 10px rgba(255,165,0,0.4);
    }
    .gugu-mini-bubble {
      background: rgba(0,0,0,0.65); backdrop-filter: blur(8px);
      padding: 10px 16px; border-radius: 14px 14px 14px 4px;
      color: #FFF8E7; font-size: 13px; font-weight: 500;
      max-width: 300px; line-height: 1.5;
      opacity: 0; transform: translateX(-10px); transition: all 0.4s;
    }
    .gugu-mini-bubble.show { opacity: 1; transform: translateX(0); }
    .gugu-mini-bubble .highlight { color: #FFD700; font-weight: 700; }

    /* ===== åœºæ™¯7ï¼šç¬¬ä¸€ä¸ªä»»åŠ¡ ===== */
    .scene-first-task { background-image: url('bg/scene7.png'); }
    .task-card-container {
      position: absolute; top: 50%; left: 50%;
      transform: translate(-50%, -50%); text-align: center;
    }
    .gugu-task-avatar {
      font-size: 50px; margin-bottom: 6px;
      animation: guguExcited 1s ease-in-out infinite;
      filter: drop-shadow(0 4px 8px rgba(0,0,0,0.2));
    }
    @keyframes guguExcited { 0%, 100% { transform: rotate(-3deg); } 50% { transform: rotate(3deg); } }
    .task-card {
      background: rgba(255, 248, 231, 0.93); backdrop-filter: blur(8px);
      border-radius: 20px; padding: 20px 26px; width: 370px;
      box-shadow: 0 8px 32px rgba(139, 90, 43, 0.25);
      border: 3px solid rgba(255, 215, 0, 0.4);
      transform: translateY(20px); opacity: 0;
      transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    .task-card.show { transform: translateY(0); opacity: 1; }
    .task-card-badge {
      display: inline-block;
      background: linear-gradient(135deg, #FFD700 0%, #F59E0B 100%);
      color: #5D4E3A; font-size: 12px; font-weight: 700;
      padding: 4px 12px; border-radius: 10px; margin-bottom: 8px;
    }
    .task-card-title { font-size: 16px; font-weight: 700; color: #5D4E3A; margin-bottom: 5px; }
    .task-card-desc { font-size: 13px; color: #8B7355; line-height: 1.6; margin-bottom: 10px; }
    .task-card-reward {
      display: inline-flex; align-items: center; gap: 6px;
      background: rgba(255,255,255,0.6); padding: 5px 14px; border-radius: 12px;
      font-size: 14px; font-weight: 600; color: #F59E0B; margin-bottom: 12px;
    }
    .task-start-btn {
      display: inline-block;
      background: linear-gradient(135deg, #4ADE80 0%, #22C55E 100%);
      border: none; border-radius: 20px; padding: 10px 34px;
      font-family: inherit; font-size: 15px; font-weight: 700; color: white;
      cursor: pointer; box-shadow: 0 4px 16px rgba(34,197,94,0.4); transition: transform 0.15s;
    }
    .task-start-btn:hover { transform: translateY(-2px); }
    .task-start-btn:active { transform: translateY(1px); }

    /* ===== åœºæ™¯è§¦å‘å¼•å¯¼ ===== */
    .scene-triggers { background: url('bg/scene7.png') center/cover no-repeat; }
    .triggers-blur {
      position: absolute; top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(255,255,255,0.15); backdrop-filter: blur(20px);
    }
    .triggers-list {
      position: absolute; top: 30px; left: 30px; right: 30px; bottom: 30px;
      display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; overflow: auto;
    }
    .trigger-item {
      background: rgba(255,255,255,0.85); backdrop-filter: blur(8px);
      border-radius: 14px; padding: 12px 14px;
      display: flex; align-items: flex-start; gap: 10px;
      cursor: pointer; border: 2px solid transparent; transition: all 0.2s;
    }
    .trigger-item:hover { border-color: #FFD700; background: rgba(255,248,231,0.9); }
    .trigger-item.active { border-color: #6366F1; background: rgba(238,242,255,0.9); }
    .trigger-num {
      width: 26px; height: 26px;
      background: linear-gradient(135deg, #6366F1 0%, #818CF8 100%);
      border-radius: 50%; display: flex; align-items: center; justify-content: center;
      color: white; font-size: 11px; font-weight: 700; flex-shrink: 0;
    }
    .trigger-title { font-size: 13px; font-weight: 600; color: #333; }
    .trigger-when { font-size: 11px; color: #888; margin-top: 2px; }
    .trigger-duration { font-size: 10px; color: #6366F1; font-weight: 600; margin-top: 3px; }
    .trigger-toast {
      position: absolute; bottom: 50px; left: 50%;
      transform: translateX(-50%) translateY(10px);
      display: flex; align-items: center; gap: 12px;
      background: rgba(0,0,0,0.75); backdrop-filter: blur(10px);
      padding: 14px 24px; border-radius: 20px; z-index: 60;
      max-width: 520px; opacity: 0; transition: all 0.4s;
    }
    .trigger-toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
    .trigger-gugu {
      width: 40px; height: 40px;
      background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
      border-radius: 50%; display: flex; align-items: center; justify-content: center;
      font-size: 22px; flex-shrink: 0;
    }
    .trigger-text { color: #FFF8E7; font-size: 13px; font-weight: 500; line-height: 1.5; }
    .trigger-btn-hint {
      display: inline-flex; align-items: center; gap: 4px;
      background: rgba(255,255,255,0.15); padding: 3px 8px; border-radius: 6px;
      font-size: 12px; color: #FFD700; animation: hintPulse 1.5s ease-in-out infinite;
    }
    @keyframes hintPulse {
      0%, 100% { background: rgba(255,255,255,0.15); }
      50% { background: rgba(255,215,0,0.25); }
    }

    /* ===== æ§åˆ¶æŒ‰é’® ===== */
    .controls-row {
      display: flex; gap: 8px; flex-wrap: wrap; justify-content: center;
      background: white; padding: 14px 20px; border-radius: 16px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.08); width: 100%;
    }
    .ctrl-btn {
      padding: 7px 14px; border-radius: 10px; border: 2px solid #E5E5E5;
      background: white; font-family: inherit; font-size: 12px; font-weight: 600;
      color: #555; cursor: pointer; transition: all 0.2s;
      display: flex; align-items: center; gap: 5px;
    }
    .ctrl-btn:hover { border-color: #FFD700; background: #FFFDF5; color: #8B5A2B; }
    .ctrl-btn.active { border-color: #6366F1; background: #EEF2FF; color: #6366F1; }
    .ctrl-btn .icon { font-size: 14px; }
    .ctrl-divider { width: 1px; height: 32px; background: #E5E5E5; align-self: center; }

    /* TTS æ§åˆ¶ */
    .tts-toggle {
      position: absolute; top: 12px; right: 12px;
      width: 36px; height: 36px;
      background: rgba(0,0,0,0.5); backdrop-filter: blur(6px);
      border: none; border-radius: 50%; cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      font-size: 18px; z-index: 150; transition: all 0.2s;
    }
    .tts-toggle:hover { background: rgba(0,0,0,0.7); transform: scale(1.1); }
    .tts-toggle.muted { opacity: 0.5; }
  </style>
</head>
<body>

<div class="v8-container">
  <div class="page-title">ğŸ¦‰ æ–°æ‰‹å¼•å¯¼ç³»ç»Ÿ - åŠ¨æ€äº¤äº’å›¾</div>
  <div class="page-subtitle">åŸºäºã€Šä¸‡ç‰©ä¹‹ä¹¦ã€‹ä¸–ç•Œè§‚ Â· æ‰‹ç»˜ç»˜æœ¬é£èƒŒæ™¯ Â· çº¦2åˆ†20ç§’</div>

  <div class="screen-area" id="screen">

    <!-- åœºæ™¯1ï¼šç¥å¥‡çš„å‘ç° -->
    <div class="scene scene-discovery active" id="scene-1">
      <div class="act-label"><span class="act-dot"></span>ç¬¬ä¸€å¹• Â· åœºæ™¯1<span class="act-time">30s</span></div>
      <div class="flower-waves">
        <div class="soundwave-ring"></div>
        <div class="soundwave-ring"></div>
        <div class="soundwave-ring"></div>
      </div>
      <div class="narration show">
        äºšç‘Ÿçˆ·çˆ·æ˜¯ä¸€ä½åšç‰©å­¦å®¶ã€‚<br>
        å°æ—¶å€™ï¼Œä»–å‘ç°äº†ä¸€ä¸ªç§˜å¯†â€”â€”<br>
        å¤§è‡ªç„¶é‡Œçš„æ¯ä¸€ç§ç”Ÿç‰©ï¼Œéƒ½åœ¨æ‚„æ‚„è¯´è¯ã€‚<br>
        çˆ·çˆ·æŠŠè¿™äº›ç¥å¥‡çš„å£°éŸ³å«åšâ€”â€”<span class="highlight">ã€Œè‡ªç„¶ä¹‹è¯­ã€</span>
      </div>
      <div class="progress-bar"><div class="progress-fill" style="width:15%"></div></div>
    </div>

    <!-- åœºæ™¯2ï¼šä¼Ÿå¤§çš„æ—…ç¨‹ -->
    <div class="scene scene-journey" id="scene-2">
      <div class="act-label"><span class="act-dot"></span>ç¬¬ä¸€å¹• Â· åœºæ™¯2<span class="act-time">30s</span></div>
      <div class="journey-panels" id="journey-panels">
        <div class="journey-panel panel-rainforest">
          <div class="narration show" style="opacity:1">ä»–å»è¿‡ä¼šä¸‹é›¨çš„æ£®æ—ï¼Œå¬è¿‡<span class="highlight">å¤§è±¡çš„è„šæ­¥å£°</span></div>
        </div>
        <div class="journey-panel panel-glacier">
          <div class="narration show" style="opacity:1">ä»–çˆ¬è¿‡å†°å†·çš„é›ªå±±ï¼Œå¬è¿‡<span class="highlight">ä¼é¹…çˆ¸çˆ¸çš„å‘¼å”¤</span></div>
        </div>
        <div class="journey-panel panel-ocean">
          <div class="narration show" style="opacity:1">ä»–è¿˜åèˆ¹å‡ºæµ·ï¼Œå¬è¿‡<span class="highlight">é²¸é±¼åœ¨æ°´ä¸‹å”±æ­Œ</span></div>
        </div>
      </div>
      <div class="progress-bar"><div class="progress-fill" style="width:30%"></div></div>
    </div>

    <!-- åœºæ™¯3ï¼šçˆ·çˆ·çš„é—æ†¾ -->
    <div class="scene scene-regret" id="scene-3">
      <div class="act-label"><span class="act-dot"></span>ç¬¬ä¸€å¹• Â· åœºæ™¯3<span class="act-time">15s</span></div>
      <div class="floating-sparkle">âœ¨</div>
      <div class="floating-sparkle">âœ¨</div>
      <div class="floating-sparkle">âœ¨</div>
      <div class="narration show">
        ä»–ç¿»å¼€ã€Šä¸‡ç‰©ä¹‹ä¹¦ã€‹ï¼Œå‘ç°è¿˜æœ‰å¥½å¤šå¥½å¤šç©ºç™½çš„é¡µã€‚<br>
        ä»–å»è¿‡é‚£ä¹ˆå¤šè¿œæ–¹â€¦â€¦å´ä»æ²¡è®¤çœŸå¬è¿‡<span class="highlight">å®¶é—¨å£é‚£åªè´è¶</span>åœ¨è¯´ä»€ä¹ˆã€‚
      </div>
      <div class="progress-bar"><div class="progress-fill" style="width:45%"></div></div>
    </div>

    <!-- åœºæ™¯4ï¼šäº¤ç»™ä½  -->
    <div class="scene scene-handover" id="scene-4">
      <div class="act-label"><span class="act-dot"></span>ç¬¬ä¸€å¹• Â· åœºæ™¯4<span class="act-time">15s</span></div>
      <div class="sparkle-anim">âœ¨</div>
      <div class="sparkle-anim">âœ¨</div>
      <div class="sparkle-anim">âœ¨</div>
      <div class="letter-card" id="letter-card">
        <div class="letter-stamp">âœ‰ï¸ äºšç‘Ÿçˆ·çˆ·çš„ä¿¡</div>
        <div class="letter-header">äº²çˆ±çš„å°æ¢é™©å®¶ï¼š</div>
        <div class="letter-body">
          å¸®çˆ·çˆ·æŠŠä¹¦å¡«æ»¡å§ï¼<br>
          å»å¬å¬ä½ å®¶é—¨å£çš„èŠ±ã€æ ‘ã€å°è™«å­éƒ½åœ¨è¯´ä»€ä¹ˆï¼Ÿ<br>
          ç­‰ä½ å‘ç°äº†æ–°çš„å£°éŸ³ï¼Œè®°å¾—å›æ¥è®²ç»™çˆ·çˆ·å¬å“¦ï¼
        </div>
        <div class="letter-signature">â€”â€” çˆ±ä½ çš„ï¼Œäºšç‘Ÿçˆ·çˆ·</div>
      </div>
      <div class="progress-bar"><div class="progress-fill" style="width:55%"></div></div>
    </div>

    <!-- åœºæ™¯5ï¼šå’•å’•ç™»åœº -->
    <div class="scene scene-gugu" id="scene-5">
      <div class="act-label"><span class="act-dot"></span>ç¬¬äºŒå¹• Â· å’•å’•ç™»åœº<span class="act-time">15s</span></div>
      <div class="gugu-eyes" id="gugu-eyes">
        <div class="gugu-eye"></div>
        <div class="gugu-eye"></div>
      </div>
      <div class="gugu-character">
        <div class="gugu-avatar-big" id="gugu-avatar">ğŸ¦‰</div>
        <div class="gugu-name-tag" id="gugu-name">å’•å’•</div>
      </div>
      <div class="narration" id="narration-5">
        å’•å’•ï¼ä½ å°±æ˜¯çˆ·çˆ·è¯´çš„å°æ¢é™©å®¶å§ï¼Ÿæˆ‘ç­‰ä½ å¥½ä¹…å•¦ï¼<br>
        æˆ‘æ˜¯å’•å’•ï½ä»¥åæœ‰é—®é¢˜éƒ½å¯ä»¥é—®æˆ‘ï¼<br>
        æ¥ï¼Œ<span class="highlight">æˆ‘æ•™ä½ æ”¶é›†è‡ªç„¶ä¹‹è¯­ï¼</span>
      </div>
      <div class="progress-bar"><div class="progress-fill" style="width:70%"></div></div>
    </div>

    <!-- åœºæ™¯6ï¼šå¿«é—¨é”®æ•™å­¦ -->
    <div class="scene scene-shutter" id="scene-6">
      <div class="act-label"><span class="act-dot"></span>ç¬¬ä¸‰å¹• Â· å¿«é—¨é”®æ•™å­¦<span class="act-time">20s</span></div>
      <div class="viewfinder-frame">
        <div class="vf-corner tl"></div>
        <div class="vf-corner tr"></div>
        <div class="vf-corner bl"></div>
        <div class="vf-corner br"></div>
      </div>
      <div class="shutter-hint">
        <div class="finger-hint">ğŸ‘†</div>
        <div class="shutter-btn-demo" id="shutter-btn" onclick="takePhoto()">ğŸ“¸</div>
      </div>
      <div class="gugu-mini">
        <div class="gugu-mini-avatar">ğŸ¦‰</div>
        <div class="gugu-mini-bubble show" id="gugu-shutter-bubble">
          çœ‹åˆ°é‚£æœµèŠ±äº†å—ï¼Ÿå®ƒæ­£åœ¨è¯´è¯å‘¢ï¼<br>æŒ‰ä¸‹<span class="highlight">çº¢è‰²æŒ‰é’®</span>ï¼Œå°±èƒ½æ”¶é›†åˆ°å®ƒçš„å£°éŸ³ï½
        </div>
      </div>
      <div class="star-burst" id="star-burst">
        <div class="flying-star">â­</div>
        <div class="flying-star">â­</div>
        <div class="flying-star">â­</div>
      </div>
      <div class="flash-overlay" id="flash-overlay"></div>
      <div class="progress-bar"><div class="progress-fill" style="width:85%"></div></div>
    </div>

    <!-- åœºæ™¯7ï¼šç¬¬ä¸€ä¸ªä»»åŠ¡ -->
    <div class="scene scene-first-task" id="scene-7">
      <div class="act-label"><span class="act-dot"></span>ç¬¬å››å¹• Â· ç¬¬ä¸€ä¸ªä»»åŠ¡<span class="act-time">15s</span></div>
      <div class="task-card-container">
        <div class="gugu-task-avatar">ğŸ¦‰</div>
        <div class="task-card" id="task-card">
          <div class="task-card-badge">ğŸŒŸ çˆ·çˆ·çš„ç¬¬ä¸€ä¸ªä»»åŠ¡</div>
          <div class="task-card-title">åˆ°å¤–é¢å»ï¼Œæ‹ä¸€å¼ ç…§ç‰‡å§ï¼</div>
          <div class="task-card-desc">
            èŠ±ã€è™«å­ã€æ ‘å¶ã€äº‘æœµâ€”â€”ä»€ä¹ˆéƒ½å¯ä»¥ï¼<br>
            ä½ å®¶é—¨å£è—ç€ä»€ä¹ˆå£°éŸ³å‘¢ï¼Ÿå’•å’•å¥½æœŸå¾…ï¼
          </div>
          <div class="task-card-reward">â­ +10 è‡ªç„¶ä¹‹è¯­</div><br>
          <button class="task-start-btn" onclick="finishOnboarding()">ğŸš€ å‡ºå‘æ¢é™©ï¼</button>
        </div>
      </div>
      <div class="progress-bar"><div class="progress-fill" style="width:100%"></div></div>
    </div>

    <!-- åœºæ™¯è§¦å‘å¼•å¯¼æ€»è§ˆ -->
    <div class="scene scene-triggers" id="scene-triggers">
      <div class="triggers-blur"></div>
      <div class="act-label"><span class="act-dot" style="background:#6366F1"></span>åœºæ™¯è§¦å‘å¼•å¯¼ Â· æ€»è§ˆ</div>
      <div class="triggers-list">
        <div class="trigger-item" onclick="showTriggerDemo(1)"><div class="trigger-num">1</div><div><div class="trigger-title">ğŸŸ£ AIé”®å¼•å¯¼</div><div class="trigger-when">æ‹å®Œç¬¬1å¼ ç…§ç‰‡ â†’ é¢„è§ˆé¡µ</div><div class="trigger-duration">â± 8s Â· å¯è·³è¿‡</div></div></div>
        <div class="trigger-item" onclick="showTriggerDemo(2)"><div class="trigger-num">2</div><div><div class="trigger-title">ğŸŸ¡ å¯¹è®²é”®å¼•å¯¼</div><div class="trigger-when">ç¬¬1æ¬¡æ‰“å¼€AIèœå•</div><div class="trigger-duration">â± 6s Â· å¯è·³è¿‡</div></div></div>
        <div class="trigger-item" onclick="showTriggerDemo(3)"><div class="trigger-num">3</div><div><div class="trigger-title">â­ æ˜Ÿæ˜Ÿæ„ä¹‰å¼•å¯¼</div><div class="trigger-when">ç´¯è®¡æ”¶é›†10é¢—æ˜Ÿæ˜Ÿ</div><div class="trigger-duration">â± 6s Â· å¯è·³è¿‡</div></div></div>
        <div class="trigger-item" onclick="showTriggerDemo(4)"><div class="trigger-num">4</div><div><div class="trigger-title">ğŸ“– ä¸‡ç‰©ä¹‹ä¹¦å¼•å¯¼</div><div class="trigger-when">ç¬¬1æ¬¡æ‰“å¼€å›¾é‰´é¡µ</div><div class="trigger-duration">â± 8s Â· å¯è·³è¿‡</div></div></div>
        <div class="trigger-item" onclick="showTriggerDemo(5)"><div class="trigger-num">5</div><div><div class="trigger-title">ğŸ—ºï¸ ä»»åŠ¡ç³»ç»Ÿå¼•å¯¼</div><div class="trigger-when">ç¬¬1æ¬¡æ‰“å¼€åœ°å›¾é¡µ</div><div class="trigger-duration">â± 8s Â· å¯è·³è¿‡</div></div></div>
        <div class="trigger-item" onclick="showTriggerDemo(6)"><div class="trigger-num">6</div><div><div class="trigger-title">ğŸ¨ åˆ›ä½œå·¥åŠå¼•å¯¼</div><div class="trigger-when">ç¬¬1æ¬¡æ‰“å¼€Workshop</div><div class="trigger-duration">â± 8s Â· å¯è·³è¿‡</div></div></div>
        <div class="trigger-item" onclick="showTriggerDemo(7)"><div class="trigger-num">7</div><div><div class="trigger-title">ğŸ’ èƒŒåŒ…å¼•å¯¼</div><div class="trigger-when">ç¬¬1æ¬¡æ‰“å¼€èƒŒåŒ…é¡µ</div><div class="trigger-duration">â± 6s Â· å¯è·³è¿‡</div></div></div>
        <div class="trigger-item" onclick="showTriggerDemo(8)"><div class="trigger-num">8</div><div><div class="trigger-title">ğŸ¦‹ æ–°ç‰©ç§å‘ç°</div><div class="trigger-when">AIè¯†åˆ«å‡ºé¦–æ¬¡è®°å½•ç‰©ç§</div><div class="trigger-duration">â± 8s Â· å¯è·³è¿‡</div></div></div>
        <div class="trigger-item" onclick="showTriggerDemo(9)"><div class="trigger-num">9</div><div><div class="trigger-title">ğŸ… é¦–æ¬¡è·å¾—å¾½ç« </div><div class="trigger-when">è¾¾æˆä»»æ„å¾½ç« æ¡ä»¶</div><div class="trigger-duration">â± 10s Â· âŒä¸å¯è·³è¿‡</div></div></div>
        <div class="trigger-item" onclick="showTriggerDemo(10)"><div class="trigger-num">10</div><div><div class="trigger-title">â¬†ï¸ é¦–æ¬¡å‡çº§</div><div class="trigger-when">Lv1 â†’ Lv2</div><div class="trigger-duration">â± 10s Â· âŒä¸å¯è·³è¿‡</div></div></div>
      </div>
    </div>

    <!-- TTS æœ—è¯»å¼€å…³ -->
    <button class="tts-toggle" id="tts-toggle" onclick="toggleTTS()" title="æœ—è¯»å¼€å…³">ğŸ”Š</button>

    <!-- ç‚¹å‡»å¯åŠ¨å±‚ï¼ˆæµè§ˆå™¨éœ€è¦ç”¨æˆ·äº¤äº’æ‰èƒ½æ’­éŸ³é¢‘ï¼‰ -->
    <div id="start-overlay" style="
      position:absolute; top:0; left:0; right:0; bottom:0; z-index:500;
      background:rgba(0,0,0,0.45); backdrop-filter:blur(6px);
      display:flex; align-items:center; justify-content:center;
      cursor:pointer;
    " onclick="startExperience()">
      <div style="text-align:center;">
        <div style="font-size:64px; margin-bottom:12px; filter:drop-shadow(0 4px 12px rgba(0,0,0,0.3));">ğŸ¦‰</div>
        <div style="color:#FFD700; font-size:20px; font-weight:700; text-shadow:0 2px 8px rgba(0,0,0,0.5);">ç‚¹å‡»å¼€å§‹æ¢é™©</div>
        <div style="color:rgba(255,255,255,0.7); font-size:13px; margin-top:6px;">Click to Start</div>
      </div>
    </div>

    <div class="trigger-toast" id="trigger-toast">
      <div class="trigger-gugu">ğŸ¦‰</div>
      <div class="trigger-text" id="trigger-toast-text"></div>
    </div>
  </div>

  <div class="controls-row">
    <button class="ctrl-btn active" onclick="goScene(1)" id="btn-s1"><span class="icon">ğŸŒ±</span> å‘ç°</button>
    <button class="ctrl-btn" onclick="goScene(2)" id="btn-s2"><span class="icon">ğŸŒ</span> æ—…ç¨‹</button>
    <button class="ctrl-btn" onclick="goScene(3)" id="btn-s3"><span class="icon">ğŸ“–</span> é—æ†¾</button>
    <button class="ctrl-btn" onclick="goScene(4)" id="btn-s4"><span class="icon">âœ‰ï¸</span> äº¤ç»™ä½ </button>
    <div class="ctrl-divider"></div>
    <button class="ctrl-btn" onclick="goScene(5)" id="btn-s5"><span class="icon">ğŸ¦‰</span> å’•å’•</button>
    <button class="ctrl-btn" onclick="goScene(6)" id="btn-s6"><span class="icon">ğŸ“¸</span> å¿«é—¨</button>
    <button class="ctrl-btn" onclick="goScene(7)" id="btn-s7"><span class="icon">ğŸŒŸ</span> ä»»åŠ¡</button>
    <div class="ctrl-divider"></div>
    <button class="ctrl-btn" onclick="goScene('triggers')" id="btn-triggers"><span class="icon">ğŸ“‹</span> åœºæ™¯è§¦å‘</button>
  </div>
</div>

<script>
let currentScene = 1, journeyTimer = null, journeyIdx = 0;
let ttsEnabled = true;
let currentAudio = null;
let audioAvailable = null; // null=æœªæ£€æµ‹, true/false

// ===== éŸ³é¢‘æ–‡ä»¶æ˜ å°„ =====
const audioFiles = {
  1: 'audio/scene1.mp3',
  '2a': 'audio/scene2a.mp3', '2b': 'audio/scene2b.mp3', '2c': 'audio/scene2c.mp3',
  3: 'audio/scene3.mp3', 4: 'audio/scene4.mp3', 5: 'audio/scene5.mp3',
  6: 'audio/scene6.mp3', '6done': 'audio/scene6done.mp3', 7: 'audio/scene7.mp3',
  't1': 'audio/trigger1.mp3', 't2': 'audio/trigger2.mp3', 't3': 'audio/trigger3.mp3',
  't4': 'audio/trigger4.mp3', 't5': 'audio/trigger5.mp3', 't6': 'audio/trigger6.mp3',
  't7': 'audio/trigger7.mp3', 't8': 'audio/trigger8.mp3', 't9': 'audio/trigger9.mp3',
  't10': 'audio/trigger10.mp3'
};

// fallback çº¯æ–‡æœ¬ï¼ˆWeb Speech API ç”¨ï¼‰
const fallbackTexts = {
  1: 'äºšç‘Ÿçˆ·çˆ·æ˜¯ä¸€ä½åšç‰©å­¦å®¶ã€‚å°æ—¶å€™ï¼Œä»–å‘ç°äº†ä¸€ä¸ªç§˜å¯†â€”â€”å¤§è‡ªç„¶é‡Œçš„æ¯ä¸€ç§ç”Ÿç‰©ï¼Œéƒ½åœ¨æ‚„æ‚„è¯´è¯ã€‚çˆ·çˆ·æŠŠè¿™äº›ç¥å¥‡çš„å£°éŸ³å«åšã€Œè‡ªç„¶ä¹‹è¯­ã€ã€‚',
  '2a': 'ä»–å»è¿‡ä¼šä¸‹é›¨çš„æ£®æ—ï¼Œå¬è¿‡å¤§è±¡çš„è„šæ­¥å£°ã€‚',
  '2b': 'ä»–çˆ¬è¿‡å†°å†·çš„é›ªå±±ï¼Œå¬è¿‡ä¼é¹…çˆ¸çˆ¸çš„å‘¼å”¤ã€‚',
  '2c': 'ä»–è¿˜åèˆ¹å‡ºæµ·ï¼Œå¬è¿‡é²¸é±¼åœ¨æ°´ä¸‹å”±æ­Œã€‚',
  3: 'ä»–ç¿»å¼€ã€Šä¸‡ç‰©ä¹‹ä¹¦ã€‹ï¼Œå‘ç°è¿˜æœ‰å¥½å¤šå¥½å¤šç©ºç™½çš„é¡µã€‚ä»–å»è¿‡é‚£ä¹ˆå¤šè¿œæ–¹â€¦â€¦å´ä»æ²¡è®¤çœŸå¬è¿‡å®¶é—¨å£é‚£åªè´è¶åœ¨è¯´ä»€ä¹ˆã€‚',
  4: 'äº²çˆ±çš„å°æ¢é™©å®¶ï¼šå¸®çˆ·çˆ·æŠŠä¹¦å¡«æ»¡å§ï¼å»å¬å¬ä½ å®¶é—¨å£çš„èŠ±ã€æ ‘ã€å°è™«å­éƒ½åœ¨è¯´ä»€ä¹ˆï¼Ÿç­‰ä½ å‘ç°äº†æ–°çš„å£°éŸ³ï¼Œè®°å¾—å›æ¥è®²ç»™çˆ·çˆ·å¬å“¦ï¼â€”â€”çˆ±ä½ çš„ï¼Œäºšç‘Ÿçˆ·çˆ·',
  5: 'å’•å’•ï¼ä½ å°±æ˜¯çˆ·çˆ·è¯´çš„å°æ¢é™©å®¶å§ï¼Ÿæˆ‘ç­‰ä½ å¥½ä¹…å•¦ï¼æˆ‘æ˜¯å’•å’•ï¼Œä»¥åæœ‰é—®é¢˜éƒ½å¯ä»¥é—®æˆ‘ï¼æ¥ï¼Œæˆ‘æ•™ä½ æ”¶é›†è‡ªç„¶ä¹‹è¯­ï¼',
  6: 'çœ‹åˆ°é‚£æœµèŠ±äº†å—ï¼Ÿå®ƒæ­£åœ¨è¯´è¯å‘¢ï¼æŒ‰ä¸‹çº¢è‰²æŒ‰é’®ï¼Œå°±èƒ½æ”¶é›†åˆ°å®ƒçš„å£°éŸ³ã€‚',
  '6done': 'å’•å’•ï¼ä½ å¬åˆ°äº†å—ï¼è¿™äº›å°æ˜Ÿæ˜Ÿï¼Œå°±æ˜¯èŠ±çš„è‡ªç„¶ä¹‹è¯­ã€‚æ”¶é›†è¶Šå¤šï¼Œçˆ·çˆ·çš„ä¹¦å°±è¶Šä¸°å¯Œå“¦ï¼',
  7: 'çˆ·çˆ·çš„ç¬¬ä¸€ä¸ªä»»åŠ¡ï¼šåˆ°å¤–é¢å»ï¼Œæ‹ä¸€å¼ ç…§ç‰‡å§ï¼èŠ±ã€è™«å­ã€æ ‘å¶ã€äº‘æœµâ€”â€”ä»€ä¹ˆéƒ½å¯ä»¥ï¼ä½ å®¶é—¨å£è—ç€ä»€ä¹ˆå£°éŸ³å‘¢ï¼Ÿå’•å’•å¥½æœŸå¾…ï¼'
};
const triggerPlain = {
  1: 'å’•å’•ï¼æ‹å¾—ä¸é”™ï½æƒ³çŸ¥é“è¿™æ˜¯ä»€ä¹ˆå—ï¼ŸæŒ‰ç´«è‰²æŒ‰é’®é—®æˆ‘ï¼',
  2: 'å¯¹äº†ï¼ä½ ä¹Ÿå¯ä»¥æŒ‰ä½é»„è‰²æŒ‰é’®ç›´æ¥è·Ÿæˆ‘è¯´è¯ï½å°±åƒå¯¹è®²æœºä¸€æ ·ï¼',
  3: 'å’•å’•ï¼ä½ å·²ç»æ”¶é›†äº†10æ®µè‡ªç„¶ä¹‹è¯­ï¼çˆ·çˆ·çš„ä¹¦åˆä¸°å¯Œäº†ä¸€ç‚¹ï½ç»§ç»­åŠ æ²¹ï¼',
  4: 'è¿™å°±æ˜¯çˆ·çˆ·çš„ã€Šä¸‡ç‰©ä¹‹ä¹¦ã€‹ï¼ä½ æ”¶é›†åˆ°çš„æ¯ä¸€ç§ç”Ÿç‰©ï¼Œéƒ½ä¼šè®°å½•åœ¨è¿™é‡Œï½çœ‹ï¼Œè¿™æ˜¯ä½ å‘ç°çš„ï¼ç‚¹å¼€çœ‹çœ‹ï¼Ÿ',
  5: 'è¿™é‡Œæ˜¯æ¢é™©ä»»åŠ¡ï¼çˆ·çˆ·ç»™ä½ å‡†å¤‡äº†ä¸€äº›å°æŒ‘æˆ˜ï¼Œå®Œæˆå°±èƒ½è·å¾—æ›´å¤šæ˜Ÿæ˜Ÿå“¦ï½',
  6: 'æ¬¢è¿æ¥åˆ°é­”æ³•å·¥åŠï¼åœ¨è¿™é‡Œï¼Œä½ å¯ä»¥æŠŠè‡ªç„¶ä¹‹è¯­å˜æˆä¸€å¹…ç”»ï½é€‰ä¸€å¼ ç…§ç‰‡ï¼Œè¯•è¯•çœ‹ï¼Ÿ',
  7: 'è¿™æ˜¯ä½ çš„æ¢é™©èƒŒåŒ…ï¼ç…§ç‰‡ã€åˆ›ä½œã€æ•…äº‹â€¦â€¦ä½ çš„å®è´éƒ½æ”¶åœ¨è¿™é‡Œå•¦ï½',
  8: 'å’•å’•å’•å’•ï¼ï¼è¿™æ˜¯ä½ ç¬¬ä¸€æ¬¡å¬åˆ°ã€Œå‡¤è¶ã€çš„å£°éŸ³ï¼å®ƒå·²ç»è¢«å†™è¿›çˆ·çˆ·çš„ä¹¦é‡Œå•¦ï½',
  9: 'å“‡ï¼ä½ è·å¾—äº†ä¸€æšæ¢é™©å®¶å¾½ç« ï¼è¿™æ˜¯çˆ·çˆ·ç»™å‰å®³çš„æ¢é™©å®¶å‡†å¤‡çš„è£èª‰å‹‹ç« ï½å»èƒŒåŒ…é‡Œçœ‹çœ‹ä½ çš„å¾½ç« å§ï¼',
  10: 'å’•å’•ï¼ä½ å‡çº§å•¦ï¼ä½ ç°åœ¨æ˜¯Lv2å¥½å¥‡å®è´äº†ï½æ”¶é›†è¶Šå¤šè‡ªç„¶ä¹‹è¯­ï¼Œå°±èƒ½å¬æ‡‚è¶Šå¤šå¤§è‡ªç„¶çš„ç§˜å¯†å“¦ï¼'
};

// ===== æ’­æ”¾é€»è¾‘ =====
function stopAudio() {
  if (currentAudio) { currentAudio.pause(); currentAudio.currentTime = 0; currentAudio = null; }
  window.speechSynthesis.cancel();
}

function speak(key) {
  stopAudio();
  if (!ttsEnabled || !key) return;

  const file = audioFiles[key];
  if (file) {
    const audio = new Audio(file);
    currentAudio = audio;
    audio.play().catch(() => {
      // mp3åŠ è½½å¤±è´¥ â†’ fallbackåˆ° Web Speech API
      if (audioAvailable === null) audioAvailable = false;
      speakFallback(key);
    });
    audio.onplay = () => { if (audioAvailable === null) audioAvailable = true; };
  } else {
    speakFallback(key);
  }
}

function speakFallback(key) {
  const text = fallbackTexts[key] || triggerPlain[key] || '';
  if (!text) return;
  const u = new SpeechSynthesisUtterance(text);
  u.lang = 'zh-CN'; u.rate = 0.9; u.pitch = 1.15;
  const voices = window.speechSynthesis.getVoices();
  const v = voices.find(v => v.lang.startsWith('zh') && v.name.includes('Female'))
    || voices.find(v => v.lang.startsWith('zh')) || null;
  if (v) u.voice = v;
  window.speechSynthesis.speak(u);
}

function toggleTTS() {
  ttsEnabled = !ttsEnabled;
  const btn = document.getElementById('tts-toggle');
  btn.textContent = ttsEnabled ? 'ğŸ”Š' : 'ğŸ”‡';
  btn.classList.toggle('muted', !ttsEnabled);
  if (!ttsEnabled) stopAudio();
  else speakCurrentScene();
}

function speakCurrentScene() {
  if (currentScene === 2) {
    speak(['2a','2b','2c'][journeyIdx]);
  } else {
    speak(currentScene);
  }
}

// ===== åœºæ™¯åˆ‡æ¢ =====
function goScene(id) {
  clearJourneyAnim();
  stopAudio();
  document.querySelectorAll('.scene').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('.ctrl-btn').forEach(b => b.classList.remove('active'));
  const el = id === 'triggers' ? document.getElementById('scene-triggers') : document.getElementById('scene-' + id);
  if (el) el.classList.add('active');
  const btn = id === 'triggers' ? document.getElementById('btn-triggers') : document.getElementById('btn-s' + id);
  if (btn) btn.classList.add('active');
  currentScene = id;
  if (id === 2) { journeyIdx = 0; startJourneyAnim(); }
  if (id === 4) initHandover();
  if (id === 5) initGugu();
  if (id === 6) resetShutter();
  if (id === 7) initFirstTask();
  if (id !== 'triggers') setTimeout(speakCurrentScene, 400);
}

function startJourneyAnim() {
  const p = document.getElementById('journey-panels');
  journeyIdx = 0;
  speak('2a');
  journeyTimer = setInterval(() => {
    journeyIdx = (journeyIdx + 1) % 3;
    p.style.transform = `translateX(-${journeyIdx * 800}px)`;
    speak(['2a','2b','2c'][journeyIdx]);
  }, 4500);
}
function clearJourneyAnim() {
  if (journeyTimer) { clearInterval(journeyTimer); journeyTimer = null; }
  const p = document.getElementById('journey-panels'); if (p) p.style.transform = 'translateX(0)';
}

function initHandover() {
  const l = document.getElementById('letter-card'); l.classList.remove('show');
  setTimeout(() => l.classList.add('show'), 800);
}

function initGugu() {
  const eyes = document.getElementById('gugu-eyes'), av = document.getElementById('gugu-avatar'),
        nm = document.getElementById('gugu-name'), nr = document.getElementById('narration-5');
  eyes.style.display = 'flex'; av.classList.remove('landed','bounce'); nm.classList.remove('show'); nr.classList.remove('show');
  setTimeout(() => { eyes.style.display = 'none'; av.classList.add('landed'); }, 1500);
  setTimeout(() => { av.classList.add('bounce'); nm.classList.add('show'); }, 2200);
  setTimeout(() => nr.classList.add('show'), 2800);
}

let photoTaken = false;
function takePhoto() {
  if (photoTaken) return; photoTaken = true;
  const flash = document.getElementById('flash-overlay'); flash.classList.add('flash');
  setTimeout(() => flash.classList.remove('flash'), 500);
  setTimeout(() => document.querySelectorAll('.flying-star').forEach(s => s.classList.add('fly')), 400);
  setTimeout(() => {
    document.getElementById('gugu-shutter-bubble').innerHTML =
      'å’•å’•ï¼ä½ å¬åˆ°äº†å—ï¼<br>è¿™äº›å°æ˜Ÿæ˜Ÿï¼Œå°±æ˜¯èŠ±çš„<span class="highlight">è‡ªç„¶ä¹‹è¯­</span>ï½<br>æ”¶é›†è¶Šå¤šï¼Œçˆ·çˆ·çš„ä¹¦å°±è¶Šä¸°å¯Œå“¦ï¼';
    speak('6done');
  }, 1000);
  document.querySelector('.finger-hint').style.display = 'none';
  document.getElementById('shutter-btn').style.animation = 'none';
}

function resetShutter() {
  photoTaken = false;
  document.querySelectorAll('.flying-star').forEach(s => s.classList.remove('fly'));
  const fh = document.querySelector('.finger-hint'); if (fh) fh.style.display = '';
  const sb = document.getElementById('shutter-btn'); if (sb) sb.style.animation = '';
  const bb = document.getElementById('gugu-shutter-bubble');
  if (bb) bb.innerHTML = 'çœ‹åˆ°é‚£æœµèŠ±äº†å—ï¼Ÿå®ƒæ­£åœ¨è¯´è¯å‘¢ï¼<br>æŒ‰ä¸‹<span class="highlight">çº¢è‰²æŒ‰é’®</span>ï¼Œå°±èƒ½æ”¶é›†åˆ°å®ƒçš„å£°éŸ³ï½';
}

function initFirstTask() {
  const c = document.getElementById('task-card'); c.classList.remove('show');
  setTimeout(() => c.classList.add('show'), 500);
}

function finishOnboarding() { alert('ğŸ‰ å¼•å¯¼å®Œæˆï¼è¿›å…¥ç›¸æœºä¸»ç•Œé¢'); }

// ===== åœºæ™¯è§¦å‘å¼•å¯¼ =====
const triggerTexts = {
  1: 'å’•å’•ï¼æ‹å¾—ä¸é”™ï½æƒ³çŸ¥é“è¿™æ˜¯ä»€ä¹ˆå—ï¼ŸæŒ‰ <span class="trigger-btn-hint">ğŸŸ£ ç´«è‰²æŒ‰é’®</span> é—®æˆ‘ï¼',
  2: 'å¯¹äº†ï¼ä½ ä¹Ÿå¯ä»¥æŒ‰ä½ <span class="trigger-btn-hint">ğŸŸ¡ é»„è‰²æŒ‰é’®</span> ç›´æ¥è·Ÿæˆ‘è¯´è¯ï½å°±åƒå¯¹è®²æœºä¸€æ ·ï¼',
  3: 'å’•å’•ï¼ä½ å·²ç»æ”¶é›†äº† <span style="color:#FFD700;font-weight:700">10æ®µè‡ªç„¶ä¹‹è¯­</span>ï¼çˆ·çˆ·çš„ä¹¦åˆä¸°å¯Œäº†ä¸€ç‚¹ï½ç»§ç»­åŠ æ²¹ï¼',
  4: 'è¿™å°±æ˜¯çˆ·çˆ·çš„ã€Šä¸‡ç‰©ä¹‹ä¹¦ã€‹ï¼ä½ æ”¶é›†åˆ°çš„æ¯ä¸€ç§ç”Ÿç‰©ï¼Œéƒ½ä¼šè®°å½•åœ¨è¿™é‡Œï½çœ‹ï¼Œè¿™æ˜¯ä½ å‘ç°çš„ï¼ç‚¹å¼€çœ‹çœ‹ï¼Ÿ',
  5: 'è¿™é‡Œæ˜¯æ¢é™©ä»»åŠ¡ï¼çˆ·çˆ·ç»™ä½ å‡†å¤‡äº†ä¸€äº›å°æŒ‘æˆ˜ï¼Œå®Œæˆå°±èƒ½è·å¾—æ›´å¤š <span style="color:#FFD700">â­ æ˜Ÿæ˜Ÿ</span> å“¦ï½',
  6: 'æ¬¢è¿æ¥åˆ°é­”æ³•å·¥åŠï¼åœ¨è¿™é‡Œï¼Œä½ å¯ä»¥æŠŠè‡ªç„¶ä¹‹è¯­å˜æˆä¸€å¹…ç”»ï½é€‰ä¸€å¼ ç…§ç‰‡ï¼Œè¯•è¯•çœ‹ï¼Ÿ',
  7: 'è¿™æ˜¯ä½ çš„æ¢é™©èƒŒåŒ…ï¼ç…§ç‰‡ã€åˆ›ä½œã€æ•…äº‹â€¦â€¦ä½ çš„å®è´éƒ½æ”¶åœ¨è¿™é‡Œå•¦ï½',
  8: 'å’•å’•å’•å’•ï¼ï¼è¿™æ˜¯ä½ ç¬¬ä¸€æ¬¡å¬åˆ° <span style="color:#FFD700;font-weight:700">ã€Œå‡¤è¶ã€</span> çš„å£°éŸ³ï¼å®ƒå·²ç»è¢«å†™è¿›çˆ·çˆ·çš„ä¹¦é‡Œå•¦ï½',
  9: 'å“‡ï¼ä½ è·å¾—äº†ä¸€æš <span style="color:#FFD700;font-weight:700">æ¢é™©å®¶å¾½ç« </span>ï¼è¿™æ˜¯çˆ·çˆ·ç»™å‰å®³çš„æ¢é™©å®¶å‡†å¤‡çš„è£èª‰å‹‹ç« ï½å»èƒŒåŒ…é‡Œçœ‹çœ‹ä½ çš„å¾½ç« å§ï¼',
  10: 'å’•å’•ï¼ä½ å‡çº§å•¦ï¼ä½ ç°åœ¨æ˜¯ <span style="color:#FFD700;font-weight:700">Lv2 å¥½å¥‡å®è´</span> äº†ï½æ”¶é›†è¶Šå¤šè‡ªç„¶ä¹‹è¯­ï¼Œå°±èƒ½å¬æ‡‚è¶Šå¤šå¤§è‡ªç„¶çš„ç§˜å¯†å“¦ï¼'
};

let triggerToastTimer = null;
function showTriggerDemo(n) {
  const toast = document.getElementById('trigger-toast'), text = document.getElementById('trigger-toast-text');
  document.querySelectorAll('.trigger-item').forEach(i => i.classList.remove('active'));
  document.querySelectorAll('.trigger-item')[n-1]?.classList.add('active');
  toast.classList.remove('show'); clearTimeout(triggerToastTimer);
  setTimeout(() => {
    text.innerHTML = triggerTexts[n] || '';
    toast.classList.add('show');
    speak('t' + n);
  }, 100);
  triggerToastTimer = setTimeout(() => toast.classList.remove('show'), 5000);
}

// é¢„åŠ è½½è¯­éŸ³
window.speechSynthesis.onvoiceschanged = () => window.speechSynthesis.getVoices();

function startExperience() {
  document.getElementById('start-overlay').style.display = 'none';
  speakCurrentScene();
}
</script>
</body>
</html>
